<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0d1117">
    <meta name="msapplication-TileColor" content="#0d1117">
    <meta name="format-detection" content="telephone=no">
    <title>EcoPOOL Live Scores</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/logo.png') }}">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="header">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="EcoPOOL" class="header-logo">
        <div class="subtitle">WVU EcoCAR Pool League - Live Scores</div>
        <div class="live-indicator">
            <span class="live-dot"></span>
            <span>LIVE</span>
        </div>
        <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button id="manager-toggle" class="manager-toggle-btn" onclick="toggleManagerMode()">
                üîß Manager Mode
            </button>
            <button class="manager-toggle-btn" onclick="openRulesModal()">
                üìñ Rules
            </button>
            <a href="/stream" target="_blank" id="stream-link" class="manager-toggle-btn" style="text-decoration: none; display: none; align-items: center;">
                üì∫ Stream View
            </a>
        </div>
    </div>
    
    <!-- Offline indicator -->
    <div id="offline-indicator" class="offline-indicator" style="display: none;">
        <span class="offline-icon">üì¥</span>
        <span class="offline-text">Offline Mode</span>
        <span id="sync-pending-count" class="sync-pending-badge" style="display: none;">0</span>
    </div>

    <div id="content">
        <div class="empty-state">
            <div class="emoji">‚è≥</div>
            <div>Loading scores...</div>
        </div>
    </div>
    
    <div class="update-time">
        Last updated: <span id="update-time">--:--:-- --</span>
        <span class="connection-status">
            <span class="status-dot" id="status-dot"></span>
            <span id="status-text">Connecting...</span>
        </span>
    </div>
    
    <!-- Scorecard Modal -->
    <div class="modal-overlay" id="scorecard-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()" aria-label="Close">&times;</span>
            <div id="scorecard-content">
                <div class="empty-state">Loading...</div>
            </div>
        </div>
    </div>
    
    <!-- Rules Modal -->
    <div class="modal-overlay" id="rules-modal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <span class="modal-close" onclick="closeRulesModal()" aria-label="Close">&times;</span>
            <div style="padding: 10px 5px;">
                <h2 style="text-align: center; margin-bottom: 5px; font-size: 1.4em;">WVU EcoPOOL League Ruleset</h2>
                <p style="text-align: center; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 20px;">Version 1</p>

                <div class="rules-section">
                    <h3 style="color: var(--green); border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 10px;">General</h3>
                    <ul style="line-height: 1.8; padding-left: 20px; font-size: 0.95em;">
                        <li>League nights are held weekly. Players must RSVP before the deadline.</li>
                        <li>There is a buy-in each week. Payment must be made before play begins.</li>
                        <li>Format is <strong>2v2</strong> (doubles). Players are paired into teams of two.</li>
                        <li>If there is an odd number of players, one person plays as a <strong>Lone Wolf</strong> (solo team). Lone wolves shoot every other turn (as if they had a partner).</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h3 style="color: var(--green); border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 10px;">Gameplay</h3>
                    <ul style="line-height: 1.8; padding-left: 20px; font-size: 0.95em;">
                        <li>8-ball rules apply. Table is <strong>open</strong> after the break until a group is legally pocketed.</li>
                        <li>The breaking team is determined before each game.</li>
                        <li>If a ball is pocketed on the break, the breaker continues shooting but the table remains <strong>open</strong>.</li>
                        <li>Teams alternate turns: Player A from Team 1, then Player A from Team 2, then Player B from Team 1, then Player B from Team 2, and so on.</li>
                        <li>A team wins the game by legally pocketing the <strong>8-ball</strong> after clearing their group.</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h3 style="color: var(--green); border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 10px;">Racking & Breaking</h3>
                    <ul style="line-height: 1.8; padding-left: 20px; font-size: 0.95em;">
                        <li>Standard 8-ball rack: 8-ball in the center, one solid and one stripe in the back corners. All other balls placed randomly.</li>
                        <li>A valid break requires at least <strong>4 balls</strong> to hit a rail or be pocketed.</li>
                        <li>If the break is not valid, the opposing team may re-rack and break, or accept the table as-is.</li>
                        <li><strong>Scratch on the break:</strong> Opposing team gets ball-in-hand behind the head string.</li>
                        <li>Pocketing the 8-ball on the break is a <strong>re-rack</strong> (same breaker breaks again).</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h3 style="color: var(--green); border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 10px;">Scoring</h3>
                    <ul style="line-height: 1.8; padding-left: 20px; font-size: 0.95em;">
                        <li><strong>1 point</strong> per ball pocketed (both teams earn points for their own balls).</li>
                        <li><strong>3 points</strong> for legally pocketing the 8-ball to win the game.</li>
                        <li>Maximum of <strong>10 points</strong> per team per game (7 balls + 3 for the 8-ball).</li>
                        <li><strong>Golden Break:</strong> Pocketing the 8-ball on the break = <strong>17 points</strong> (all 15 balls + 8-ball bonus, both teams' worth).</li>
                        <li><strong>Early 8-ball</strong> (scratching on the 8 or pocketing it illegally): Opponent receives <strong>10 points</strong>.</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h3 style="color: var(--green); border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 10px;">Fouls</h3>
                    <ul style="line-height: 1.8; padding-left: 20px; font-size: 0.95em;">
                        <li><strong>Ball-in-hand:</strong> Opponent may place the cue ball anywhere on the table after a foul.</li>
                        <li><strong>Scratch:</strong> Cue ball pocketed = ball-in-hand for opponent.</li>
                        <li>Hitting opponent's ball first (when table is not open) = foul.</li>
                        <li>No rail contact after cue ball hits object ball = foul.</li>
                        <li>At least one foot must remain on the ground during a shot.</li>
                        <li><strong>Combo shots</strong> are allowed as long as you hit your own ball first.</li>
                        <li>The 8-ball is <strong>not</strong> a neutral ball and should not be hit first unless it is your legal target.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Reaction bar -->
    <div class="reaction-bar">
        <div class="reaction-buttons">
            <button class="reaction-btn reaction-btn-img" onclick="sendReaction('ecocar', event)" title="EcoCAR!">
                <img src="{{ url_for('static', filename='images/ecoREACTION.png') }}" alt="EcoCAR" class="reaction-img">
            </button>
            <button class="reaction-btn" onclick="sendReaction('nice_shot', event)" title="Nice shot!">üéØ</button>
            <button class="reaction-btn" onclick="sendReaction('fire', event)" title="Fire!">üî•</button>
            <button class="reaction-btn" onclick="sendReaction('clutch', event)" title="Clutch!">üí™</button>
            <button class="reaction-btn" onclick="sendReaction('gg', event)" title="GG!">üëè</button>
            <button class="reaction-btn" onclick="sendReaction('trophy', event)" title="Trophy">üèÜ</button>
            <button class="reaction-btn" onclick="sendReaction('wow', event)" title="WOW!">üòÆ</button>
            <button class="reaction-btn" onclick="sendReaction('heart', event)" title="Heart">‚ù§Ô∏è</button>
            <button class="reaction-btn" onclick="sendReaction('pool', event)" title="Pool">üé±</button>
        </div>
    </div>
    
    <!-- Reaction display overlay -->
    <div class="reaction-overlay" id="reactionOverlay"></div>
    
    <!-- Offline support modules (must load before app.js) -->
    <script src="{{ url_for('static', filename='js/offline-db.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sync-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // Register Service Worker for PWA support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registered with scope:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
